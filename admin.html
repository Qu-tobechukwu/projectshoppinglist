<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin — Stellies</title>
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" href="./assets/logo.svg" type="image/svg+xml">
  <link rel="stylesheet" href="./style.css" />
  <style>.admin-wrap{max-width:1100px;margin:20px auto;padding:12px}.hidden{display:none}</style>
</head>
<body>
  <header class="tb">
    <div class="tb-inner">
      <div class="logo-area">
        <a href="./index.html"><img src="./assets/logo.svg" alt="Stellies" class="logo" /></a>
        <div class="tagline">Admin (private)</div>
        <hr class="gold-divider" />
      </div>
    </div>
  </header>

  <main class="admin-wrap">
    <div id="loginPanel" class="card">
      <div class="muted">Enter admin password</div>
      <div style="margin-top:8px;display:flex;gap:8px;">
        <input id="adminPw" type="password" placeholder="Password" />
        <button id="unlockBtn" class="btn">Unlock</button>
        <button id="clearPending" class="btn ghost">Clear pending</button>
      </div>
    </div>

    <div id="adminUI" class="hidden">
      <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px;">
        <button id="refreshAdmin" class="btn">Refresh</button>
        <button id="exportCSV" class="btn ghost">Download CSV</button>
      </div>

      <div id="summary" class="muted"></div>

      <table id="ordersTable" style="width:100%;border-collapse:collapse">
        <thead><tr><th>Order #</th><th>Name</th><th>Phone</th><th>Delivery</th><th>Items</th><th>Total</th><th>Date</th><th>Packed</th></tr></thead>
        <tbody id="ordersBody"><tr><td colspan="8">Loading…</td></tr></tbody>
      </table>
    </div>
  </main>

<script>
  async function sha256hex(s){
    const enc = new TextEncoder().encode(s);
    const h = await crypto.subtle.digest('SHA-256', enc);
    return Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,'0')).join('');
  }
  // ADMIN_HASH is SHA-256 of your chosen admin password. Keep secret; this is client-side gate only.
  const ADMIN_HASH = '51d8fb68183ff49fa4c539d127879d4360584e197cb76b6901a3c55268748c9f'; // example: sha256(forphoneuseemail@gmail.com)

  document.getElementById('unlockBtn').addEventListener('click', async ()=>{
    const v = document.getElementById('adminPw').value || '';
    const h = await sha256hex(v);
    if(h === ADMIN_HASH){ document.getElementById('loginPanel').classList.add('hidden'); document.getElementById('adminUI').classList.remove('hidden'); loadOrders(); }
    else alert('Incorrect password');
  });

  function loadOrders(){
    const pending = JSON.parse(localStorage.getItem('stellies_pending_orders')||'[]');
    const body = document.getElementById('ordersBody'); body.innerHTML = '';
    if(pending.length===0){ body.innerHTML = '<tr><td colspan="8">No pending orders</td></tr>'; return; }
    pending.forEach(o=>{
      const items = (o.items||[]).map(i => `${i.qty}× ${i.itemName}${i.flavour?' ('+i.flavour+')':''}`).join('; ');
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${o.orderNumber}</td><td>${o.name}</td><td>${o.phone}</td><td>${o.delivery}</td><td>${items}</td><td>R ${Number(o.total||0).toFixed(2)}</td><td>${o.timestamp}</td><td>${o.packed? 'Yes':'No'}</td>`;
      body.appendChild(tr);
    });
  }

  document.getElementById('clearPending').addEventListener('click', ()=>{ if(confirm('Clear pending?')){ localStorage.removeItem('stellies_pending_orders'); loadOrders(); }});
  document.getElementById('exportCSV').addEventListener('click', ()=>{ alert('Export feature ready'); });
</script>
</body>
</html>
